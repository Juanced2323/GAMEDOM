
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Hundir la Flota – Partida</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- estilos globales del portal -->
  <link rel="stylesheet" href="../../css/Index.css">
  <!-- hoja propia de Unity (no tocar) -->
  <link rel="stylesheet" href="TemplateData/style.css">

  <style>
/* ———————————————————— PALETA & TIPOGRAFÍA ———————————————————— */
body{margin:0;background:#F9DFBC;font-family:Arial,Helvetica,sans-serif}

/* —————————— BARRA SUPERIOR (igual que index) —————————— */
.menu-superior{height:80px;background:#7d110d;display:flex;justify-content:space-between;align-items:center;padding:0 40px}
.menu-superior img.logo{height:55px}
.menu-superior a{color:#F9DFBC;font-size:20px;font-weight:bold;margin-left:35px}

/* —————————— ESTRUCTURA CENTRAL —————————— */
.wrapper{max-width:1600px;margin:30px auto 60px;padding:0 15px;display:flex;gap:30px;align-items:flex-start;flex-wrap:wrap}

/* —————————— MARCADOR —————————— */
#panel-left{flex:0 0 260px;display:flex;flex-direction:column;gap:18px}
#marcador{background:#fff;width:100%;padding:18px;border-radius:8px;box-shadow:0 3px 10px rgba(0,0,0,.12);color:#7d110d}
#marcador h3{margin:0 0 12px;text-align:center}
.barcos{display:flex;justify-content:space-between;margin:8px 0}
.barcos span:last-child{font-weight:bold;color:#007bff}
.turno{margin-top:14px;font-weight:bold}
#ganador{margin-top:15px;color:#d9534f;text-align:center}
#historial{margin-top:15px;max-height:190px;overflow-y:auto;border-top:1px solid #ddd;padding-top:8px;font-size:.9em}
#historial li{border-bottom:1px dashed #ddd;padding:4px 0}

/* ——— BOTÓN FINALIZAR TURNO ——— */
#btn-finalizar-turno{background:#f0932b;color:#fff;border:none;border-radius:6px;width:100%;padding:14px 0;font-size:1rem;font-weight:bold;cursor:pointer;transition:.25s}
#btn-finalizar-turno:hover{background:#d77e16}
#btn-finalizar-turno:disabled{background:#ccc;color:#666;cursor:not-allowed}

/* —————————— UNITY —————————— */
#unity-container{flex:1 1 900px;max-width:100%;background:#000;border-radius:8px;box-shadow:0 3px 10px rgba(0,0,0,.15);overflow:hidden}
#unity-canvas{width:100%;height:auto;display:block}

/* —————————— CHAT —————————— */
.chat-container{flex:0 0 300px;display:flex;flex-direction:column;background:#fff;border-radius:8px;box-shadow:0 3px 10px rgba(0,0,0,.12);max-height:calc(100vh - 110px);overflow:hidden}
.chat-container h2{margin:0;background:#7d110d;color:#F9DFBC;padding:10px;font-size:1rem;text-align:center}
.chat-box{flex:1;padding:12px;overflow-y:auto;font-size:.9em}
#chat-input-container{display:flex;gap:8px;padding:10px;border-top:1px solid #eee}
#chat-input{flex:1;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:.9em}
#chat-input-container button{background:#7d110d;color:#F9DFBC;border:none;border-radius:4px;padding:8px 14px;cursor:pointer;font-weight:bold}
#chat-input-container button:hover{background:#5e0e0b}

/* —————————— RESPONSIVE —————————— */
@media(max-width:992px){
  .wrapper{flex-direction:column;align-items:center}
  #panel-left{width:90%}
  .chat-container{width:90%;max-height:500px}
}
@media(max-width:600px){
  #unity-container{flex-basis:100%}
  #panel-left,#marcador{font-size:.9em}
}

/* ░░ FIN DE PARTIDA ░░ */
#end-screen{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:99999;padding:20px}
#end-screen.show{display:flex;animation:fadeInScale .6s ease-out forwards}
@keyframes fadeInScale{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}

#end-screen .card{background:#fff;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.3);padding:40px 60px;max-width:400px;width:100%;text-align:center}
#end-screen h1{margin:0 0 15px;font-size:2.4rem;color:#7d110d;text-transform:uppercase}
#end-screen .elo{font-size:1.6rem;color:#e74a3b;margin-bottom:25px}
#end-screen .elo span{display:inline-block;min-width:2ch;animation:countUp 1.2s ease-out both}
@keyframes countUp{from{transform:translateY(-10px);opacity:0}to{transform:translateY(0);opacity:1}}

/* botón bonito + animación pulse */
#end-screen .close-btn{background:#f0932b;color:#fff;border:none;border-radius:8px;padding:16px 40px;font-size:1.05rem;font-weight:bold;cursor:pointer;transition:transform .2s,box-shadow .2s}
#end-screen .close-btn:hover{transform:translateY(-3px) scale(1.03);box-shadow:0 8px 18px rgba(0,0,0,.25)}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(240,147,43,.6)}50%{box-shadow:0 0 0 15px rgba(240,147,43,0)}}
.pulse{animation:pulse 2s infinite}
/* ░░ /FIN DE PARTIDA ░░ */
  </style>
</head>

<body>
<!-- ═════ MENÚ SUPERIOR ═════ -->
<header class="menu-superior">
  <div class="nav-left"><img src="../../images/imagenes/Logo.png" alt="Logo Gamedom" class="logo"></div>
  <div class="nav-right">
    <a href="../../index.php">Inicio</a><a href="../../biblioteca.php">Biblioteca</a>
    <a href="../../comunidad.php">Comunidad</a><a href="../../premios.php">Premios</a>
    <a href="../../perfil.php">Perfil</a>
  </div>
</header>

<!-- ═════ CONTENIDO ═════ -->
<main class="wrapper">
  <!-- panel izquierdo -->
  <aside id="panel-left">
    <div id="marcador">
      <h3>Marcador</h3>
      <div class="barcos"><span>Barcos Jugador 1:</span><span id="barcos1">5</span></div>
      <div class="barcos"><span>Barcos Jugador 2:</span><span id="barcos2">5</span></div>
      <p class="turno">Turno: <span id="turno">Jugador 1</span></p>
      <p id="ganador"></p>
      <div id="historial"><h4>Historial de movimientos</h4><ul id="listaHistorial"></ul></div>
    </div>
    <button id="btn-finalizar-turno">Finalizar Turno</button>
  </aside>

  <!-- Unity -->
  <div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty"><div id="unity-progress-bar-full"></div></div>
    </div>
    <div id="unity-warning"></div><div id="unity-footer" style="display:none"></div>
  </div>

  <!-- Chat -->
  <div id="chat-container" class="chat-container">
    <h2>Chat en Vivo</h2>
    <div id="chat-box" class="chat-box"></div>
    <div id="chat-input-container">
      <input type="text" id="chat-input" placeholder="Escribe un mensaje…"><button>Enviar</button>
    </div>
  </div>
</main>

<!-- ░░ OVERLAY FIN DE PARTIDA ░░ -->
<div id="end-screen">
  <div class="card">
    <h1>¡HAS GANADO!</h1>
    <p class="elo">ELO ganado: <span id="elo-gained">+0</span></p>
    <button class="close-btn pulse" onclick="document.getElementById('end-screen').classList.remove('show')">Continuar</button>
  </div>
</div>
<!-- ░░ /OVERLAY ░░ -->

<!-- ═════ SCRIPTS ═════ -->
<script>
/* — Marcador simulado — */
let turno=1,juegoTerminado=false,numeroMovimiento=1;
let barcosJugador1=Array.from({length:5},()=>Math.floor(Math.random()*4)+2);
let barcosJugador2=Array.from({length:5},()=>Math.floor(Math.random()*4)+2);

const bar1=document.getElementById("barcos1"),
      bar2=document.getElementById("barcos2"),
      turnoSpan=document.getElementById("turno"),
      ganador=document.getElementById("ganador"),
      listaHistorial=document.getElementById("listaHistorial");

function actualizarMarcador(){
  bar1.textContent=barcosJugador1.length;
  bar2.textContent=barcosJugador2.length;
  turnoSpan.textContent=turno===1?"Jugador 1":"Jugador 2";
  if(barcosJugador1.length===0){ganador.textContent="¡Ha ganado el Jugador 2!";juegoTerminado=true}
  if(barcosJugador2.length===0){ganador.textContent="¡Ha ganado el Jugador 1!";juegoTerminado=true}
}
function registrarMovimiento(txt,col){
  const li=document.createElement('li');li.textContent=txt;li.style.color=col;listaHistorial.prepend(li);
}
function cambiarBarcos(j){
  if(juegoTerminado)return;
  const acierto=Math.random()<.5;let m="",c="";
  if(j===1&&barcosJugador2.length){
    if(acierto){barcosJugador2[0]--;c="blue";
      if(barcosJugador2[0]===0){barcosJugador2.shift();c="green";m=`Turno ${numeroMovimiento}: J1 hunde barco!`;}
      else m=`Turno ${numeroMovimiento}: J1 impacta!`;
    }else{m=`Turno ${numeroMovimiento}: J1 falló`;c="red";}
  }
  if(j===2&&barcosJugador1.length){
    if(acierto){barcosJugador1[0]--;c="blue";
      if(barcosJugador1[0]===0){barcosJugador1.shift();c="green";m=`Turno ${numeroMovimiento}: J2 hunde barco!`;}
      else m=`Turno ${numeroMovimiento}: J2 impacta!`;
    }else{m=`Turno ${numeroMovimiento}: J2 falló`;c="red";}
  }
  if(m)registrarMovimiento(m,c);
  numeroMovimiento++;turno=turno===1?2:1;actualizarMarcador();
}
setInterval(()=>cambiarBarcos(turno),3000);
actualizarMarcador();

/* — Unity loader (igual que antes, sin cambios) — */
const canvas=document.getElementById("unity-canvas");
function unityShowBanner(msg,type){
  const warn=document.getElementById("unity-warning"),div=document.createElement("div");
  div.innerHTML=msg;warn.appendChild(div);
  if(type==='error')div.style='background:red;padding:10px;';
  else{div.style='background:yellow;padding:10px;';setTimeout(()=>warn.removeChild(div),5000);}
  warn.style.display=warn.children.length?'block':'none';
}
const buildUrl="Build",loaderUrl=buildUrl+"/hlf.loader.js";
const config={dataUrl:buildUrl+"/hlf.data",frameworkUrl:buildUrl+"/hlf.framework.js",
              codeUrl:buildUrl+"/hlf.wasm",streamingAssetsUrl:"StreamingAssets",
              companyName:"DefaultCompany",productName:"HundirLaFlota",
              productVersion:"0.1.0",showBanner:unityShowBanner};
if(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){
  const meta=document.createElement('meta');meta.name='viewport';
  meta.content='width=device-width,height=device-height,initial-scale=1.0';document.head.appendChild(meta);
  canvas.className="unity-mobile";
}else{canvas.style.width="100%";canvas.style.height="auto";}
document.getElementById("unity-loading-bar").style.display="block";
const s=document.createElement("script");s.src=loaderUrl;
s.onload=()=>{createUnityInstance(canvas,config,p=>{document.getElementById("unity-progress-bar-full").style.width=100*p+"%";})
  .then(u=>{document.getElementById("unity-loading-bar").style.display="none";
            document.getElementById("unity-fullscreen-button").onclick=()=>u.SetFullscreen(1);})
  .catch(alert);};
document.body.appendChild(s);

/* — Overlay de FIN DE PARTIDA — */
const eloGain=Math.floor(Math.random()*26)+15; // 15-40 ELO
document.getElementById('elo-gained').textContent='+'+eloGain;

/* Muestra el overlay 10 s después de cargar el DOM */
document.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>document.getElementById('end-screen').classList.add('show'),10000);});
</script>

<!-- otros scripts de turno/chat originales (sin tocar) -->
<script src="../../js/turno.js"></script>
<script src="../../js/chatjuegos.js"></script>
</body>
</html>
